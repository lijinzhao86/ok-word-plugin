<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Word AI 精准修订 POC</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/diff-match-patch/1.0.5/index.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f3f2f1; padding: 40px; color: #323130; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1 { color: #0078d4; font-size: 24px; border-bottom: 2px solid #0078d4; padding-bottom: 10px; }
        .input-group { display: flex; gap: 20px; margin-bottom: 20px; }
        .input-box { flex: 1; display: flex; flex-direction: column; }
        textarea { height: 120px; padding: 10px; border: 1px solid #8a8886; border-radius: 4px; font-size: 14px; resize: none; }
        label { margin-bottom: 5px; font-weight: bold; }
        button { background: #0078d4; color: white; border: none; padding: 12px 24px; border-radius: 4px; cursor: pointer; font-size: 16px; align-self: flex-start; }
        button:hover { background: #005a9e; }
        .result-section { margin-top: 30px; display: flex; gap: 20px; }
        .log-panel { flex: 1; background: #faf9f8; padding: 15px; border: 1px solid #edebe9; border-radius: 4px; height: 300px; overflow-y: auto; }
        .preview-panel { flex: 1; background: #fff; padding: 15px; border: 1px solid #edebe9; border-radius: 4px; height: 300px; font-size: 18px; line-height: 1.6; }
        .instr-log { font-family: 'Consolas', monospace; font-size: 12px; margin-bottom: 5px; color: #605e5c; }
        .instr-move { color: #0078d4; }
        .instr-del { color: #a4262c; font-weight: bold; }
        .instr-ins { color: #107c10; font-weight: bold; }
        .del-mark { color: #a4262c; text-decoration: line-through; background: #fde7e9; }
        .ins-mark { color: #107c10; text-decoration: underline; background: #dff6dd; }
    </style>
</head>
<body>

<div class="container">
    <h1>Word AI 精准修订逻辑验证 (POC)</h1>
    <p>这个 POC 模拟了 AI 返回 Markdown 后，插件如何将其“指令化”地写入 Word 以产生精细的修订标记。</p>

    <div class="input-group">
        <div class="input-box">
            <label>原始文本 (Word 中选中的)</label>
            <textarea id="oldText">我今天非常高兴能在这里和你一起研究 Word 插件的开发方案。</textarea>
        </div>
        <div class="input-box">
            <label>AI 修改后的文本 (Markdown/Plain)</label>
            <textarea id="newText">我今天特别荣幸能与你共同探讨 Word 插件的研发技术方案。</textarea>
        </div>
    </div>

    <button onclick="runDiff()">模拟执行精准修改</button>

    <div class="result-section">
        <div class="input-box">
            <label>Word API 指令序列 (驱动 Office.js)</label>
            <div id="log" class="log-panel"></div>
        </div>
        <div class="input-box">
            <label>Word 文档预览 (修订模式效果)</label>
            <div id="preview" class="preview-panel"></div>
        </div>
    </div>
</div>

<script>
    const dmp = new diff_match_patch();

    function runDiff() {
        const text1 = document.getElementById('oldText').value;
        const text2 = document.getElementById('newText').value;
        const log = document.getElementById('log');
        const preview = document.getElementById('preview');
        
        log.innerHTML = '';
        preview.innerHTML = '';

        // 1. 计算差异 (Diff)
        const diffs = dmp.diff_main(text1, text2);
        dmp.diff_cleanupSemantic(diffs);

        // 2. 模拟 Office.js 指令执行
        log.innerHTML += `<div class="instr-log"><b>// 开启 Word 修订模式</b></div>`;
        log.innerHTML += `<div class="instr-log">context.document.changeTrackingMode = "TrackAll";</div><br>`;

        diffs.forEach(([type, text]) => {
            if (type === 0) { // Keep (Equal)
                log.innerHTML += `<div class="instr-log instr-move">range.moveRight(${text.length}); // 跳过未修改部分: "${text}"</div>`;
                preview.innerHTML += text;
            } else if (type === -1) { // Delete
                log.innerHTML += `<div class="instr-log instr-del">range.expandTo("${text}"); range.delete(); // 执行删除操作</div>`;
                preview.innerHTML += `<span class="del-mark">${text}</span>`;
            } else if (type === 1) { // Insert
                log.innerHTML += `<div class="instr-log instr-ins">range.insertText("${text}", "Before"); // 执行插入操作</div>`;
                preview.innerHTML += `<span class="ins-mark">${text}</span>`;
            }
        });

        log.innerHTML += `<br><div class="instr-log"><b>// 任务完成，同步上下文</b></div>`;
        log.innerHTML += `<div class="instr-log">await context.sync();</div>`;
    }
</script>

</body>
</html>
